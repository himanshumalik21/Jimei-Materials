// Products Page Specific JavaScript

// Filter functionality for products
document.addEventListener('DOMContentLoaded', function() {
    // Initialize product filters if they exist
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    if (filterButtons.length > 0) {
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons
                filterButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Here you would filter the products based on the selected category
                const filter = this.dataset.filter || 'all';
                filterProducts(filter);
            });
        });
    }
    
    // Initialize comparison table interactions
    const comparisonTable = document.querySelector('.comparison-table');
    if (comparisonTable) {
        // Add zebra striping
        const rows = comparisonTable.querySelectorAll('tbody tr');
        rows.forEach((row, index) => {
            if (index % 2 === 0) {
                row.classList.add('table-light');
            }
        });
    }
    
    // Initialize tooltips for spec badges
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Add smooth scrolling for anchor links within the page
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const href = this.getAttribute('href');
            if (href !== '#') {
                e.preventDefault();
                const target = document.querySelector(href);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        });
    });
});

// Product filtering function
function filterProducts(filter) {
    // This is a placeholder function
    // In a real implementation, you would:
    // 1. Fetch products from an API or filter existing DOM elements
    // 2. Show/hide products based on the filter
    // 3. Update the URL or state
    
    console.log(`Filtering products by: ${filter}`);
    
    // Example implementation:
    // const products = document.querySelectorAll('.product-item');
    // products.forEach(product => {
    //     const categories = product.dataset.category.split(' ');
    //     if (filter === 'all' || categories.includes(filter)) {
    //         product.style.display = 'block';
    //     } else {
    //         product.style.display = 'none';
    //     }
    // });
}

// Material specification toggle functionality
function toggleMaterialSpecs(materialId) {
    const specs = document.getElementById(`specs-${materialId}`);
    if (specs) {
        specs.classList.toggle('expanded');
    }
}

// Download resource function
function downloadResource(resourceId, resourceType) {
    // In a real implementation, this would trigger a download
    // Example: window.location.href = `/download/${resourceId}`;
    
    console.log(`Downloading ${resourceType} with ID: ${resourceId}`);
    
    // Show a success message (optional)
    const toast = document.createElement('div');
    toast.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 end-0 m-3';
    toast.style.zIndex = '9999';
    toast.innerHTML = `
        <strong>Success!</strong> Your download has started.
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(toast);
    
    // Remove the toast after 5 seconds
    setTimeout(() => {
        if (toast.parentNode) {
            toast.remove();
        }
    }, 5000);
}

// Sample data export for comparison (could be used for CSV export)
function exportComparisonData() {
    const table = document.querySelector('.comparison-table');
    if (!table) return;
    
    const rows = table.querySelectorAll('tr');
    let csvContent = "data:text/csv;charset=utf-8,";
    
    rows.forEach(row => {
        const cols = row.querySelectorAll('th, td');
        const rowData = Array.from(cols).map(col => `"${col.textContent.trim()}"`).join(',');
        csvContent += rowData + "\r\n";
    });
    
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "ceramic_substrate_comparison.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Initialize when DOM is loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProductsPage);
} else {
    initProductsPage();
}

function initProductsPage() {
    // Set current year in footer
    const yearElement = document.getElementById('currentYear');
    if (yearElement) {
        yearElement.textContent = new Date().getFullYear();
    }
    
    // Add print functionality
    const printButtons = document.querySelectorAll('[data-print]');
    printButtons.forEach(button => {
        button.addEventListener('click', () => window.print());
    });
}